# procon34_api
## 簡易サーバーを動かす方法
以下のような設定ファイルを用意し, server コマンドに -c で指定して実行すると 10 秒後に試合が開始されます。
```json
{
  "teams": [
    {"name": "先攻チーム", "token": "先攻チームのトークン"},
    {"name": "後攻チーム", "token": "後攻チームのトークン"}
  ],
  "match": {
    "id": 10,
    "turns": 30,
    "turnSeconds": 3,
    "bonus": {
      "wall": 10,
      "territory": 30,
      "castle": 100
    },
    "board": {
      "width": 11,
      "height": 11,
      "mason": 2,
      "structures": [
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0],
        [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0],
        [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],
        [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0],
        [ 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0],
        [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0],
        [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],
        [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0],
        [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
      ],
      "masons": [
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0,-1, 0, 0, 0, 0, 0, 0, 0,-2, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0],
        [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
      ]
    }
  }
}
```
ポートは 3000 番で受け付けますが `-l :8000` などを引数に渡すと使用するポートを変更することができます。
または環境変数 `PORT` によっても指定できます。その際には `PORT=3000` のように指定してください。

起動してから試合開始までの時間はデフォルトで 10 秒になっていますが `-start 1s` のように引数で渡すことで変更することができます。

# 試合状態取得APIのレスポンスについて
起動後、決められた時間が経つと試合が始まり1ターン目が始まります。
1ターン目の間競技サーバーからは下記のような0ターン目(初期状態)の情報が返ってきます。
```json
{
    "id": 10,
    "turn": 0,
    "board": {
        "width": 11,
        "height": 11,
        "mason": 2,
        "structures": [
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0 ],
            [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0 ],
            [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0 ],
            [ 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0 ],
            [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0 ],
            [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 ],
            [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0 ],
            [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        ],
        "masons": [
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0,-1, 0, 0, 0, 0, 0, 0, 0,-2, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        ],
        "walls": [
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        ],
        "territories": [
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
        ]
    },
    "logs": []
}
```


その後2ターン目になると競技サーバーは1ターン目の行動が反映された状態のターンを返します。
```json
{
  "id": 10,
  "turn": 1,
  "board": {
    "width": 11,
    "height": 11,
    "mason": 2,
    "structures": [
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0 ],
      [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0 ],
      [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 ],
      [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0 ],
      [ 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0 ],
      [ 0, 1, 0, 0, 2, 0, 2, 0, 0, 1, 0 ],
      [ 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 ],
      [ 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0 ],
      [ 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
    ],
    "masons": [
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0,-1, 0, 0, 0, 0, 0, 0, 0,-2, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
    ],
    "walls": [
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
    ],
    "territories": [
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
      [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
    ]
  },
  "logs": [
    {
      "turn": 1,
      "actions": [
        { "type": 2, "dir": 4, "succeeded": true },
        { "type": 2, "dir": 4, "succeeded": true }
      ]
    }
  ]
}
```

3ターン目以降のnターン目も同様にn-1ターンの確定した盤面の情報を返します。
